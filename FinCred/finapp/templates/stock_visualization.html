<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Visualizations</title>

    <!-- Static CSS -->
    <link rel="stylesheet" href="{% static 'stock_dash.css' %}">

    <!-- Plotly JS -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <style>
        /* Basic styling for the charts */
        #visualizations {
            display: none;
        }

        .chart-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
        }

        .chart {
            width: 48%;
            height: 400px;
            margin: 20px 0;
        }

        .summary-card {
            padding: 20px;
            border: 1px solid #ccc;
            margin-bottom: 20px;
        }

        .summary-card h3 {
            margin-bottom: 10px;
        }

        .summary-card p {
            margin: 5px 0;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Stock Visualizations</h1>

        <!-- Stock Selection Buttons (Example for stock button) -->
        <button class="stock-btn" data-id="1">Stock 1</button>
        <button class="stock-btn" data-id="2">Stock 2</button>
        <!-- Add more buttons as necessary -->

        <!-- Summary Section -->
        <div class="summary-card">
            <h3>Stock Summary</h3>
            <p><strong>Latest Close:</strong> <span id="latest-close">Loading...</span></p>
            <p><strong>Price Change:</strong> <span id="price-change">Loading...</span></p>
            <p><strong>Price Change Percent:</strong> <span id="price-change-percent">Loading...</span></p>
        </div>

        <!-- Visualizations Section -->
        <div id="visualizations">
            <h2>Stock Visualizations:</h2>
            <div class="chart-container">
                <!-- Candlestick Chart -->
                <div id="candlestick-chart" class="chart"></div>

                <!-- Returns Chart -->
                <div id="returns-chart" class="chart"></div>

                <!-- OBV Chart (If applicable) -->
                <div id="obv-chart" class="chart"></div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            // Fetch stock data when a stock is selected
            $(document).on("click", ".stock-btn", function () {
                const stockId = $(this).data("id");
                $.ajax({
                    url: "{% url 'get_genvisuals' %}?stock=" + stockId,
                    method: "GET",
                    success: function (data) {
                        // Update Summary Cards
                        $("#latest-close").text(data.summary.latest_close);
                        $("#price-change").text(data.summary.price_change);
                        $("#price-change-percent").text(data.summary.price_change_percent.toFixed(2) + '%');

                        // Candlestick Chart
                        const candlestickTrace = {
                            x: data.candlestick.x,
                            open: data.candlestick.open,
                            high: data.candlestick.high,
                            low: data.candlestick.low,
                            close: data.candlestick.close,
                            type: "candlestick",
                            xaxis: "x",
                            yaxis: "y",
                        };

                        const candlestickLayout = {
                            title: "Candlestick Chart",
                            xaxis: { title: "Date" },
                            yaxis: { title: "Price" },
                        };

                        Plotly.newPlot("candlestick-chart", [candlestickTrace], candlestickLayout);

                        // Returns Chart
                        const dailyReturnsTrace = {
                            x: data.returns.dates,
                            y: data.returns.daily_returns,
                            type: 'scatter',
                            mode: 'lines',
                            name: 'Daily Returns'
                        };

                        const cumulativeReturnsTrace = {
                            x: data.returns.dates,
                            y: data.returns.cumulative_returns,
                            type: 'scatter',
                            mode: 'lines',
                            name: 'Cumulative Returns'
                        };

                        const returnsLayout = {
                            title: 'Returns Chart',
                            xaxis: { title: 'Date' },
                            yaxis: { title: 'Returns' }
                        };

                        Plotly.newPlot('returns-chart', [dailyReturnsTrace, cumulativeReturnsTrace], returnsLayout);

                        // Show the visualizations
                        $("#visualizations").show();
                    },
                });
            });
        });
    </script>

</body>
</html>
